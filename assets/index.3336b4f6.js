var w=Object.defineProperty;var h=Object.getOwnPropertySymbols;var S=Object.prototype.hasOwnProperty,$=Object.prototype.propertyIsEnumerable;var p=(t,e,n)=>e in t?w(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,l=(t,e)=>{for(var n in e||(e={}))S.call(e,n)&&p(t,n,e[n]);if(h)for(var n of h(e))$.call(e,n)&&p(t,n,e[n]);return t};import{p as y,S as I}from"./index.cc0c92e1.js";import{S as x}from"./index.8e7d81d0.js";import{I as Y}from"./index.7e6c9d9a.js";import{p as X,P as C}from"./index.0c749892.js";import{d as D}from"./create.03b31fc7.js";import{p as m,m as k}from"./components.e000a0b0.js";import{t as d,h as z,d as V,e as b}from"./shared.f8da68a0.js";import{n as M}from"./index.0a9349fd.js";import{a as A}from"./vendor.10bd23ac.js";const F=l(l({show:{type:Boolean,default:!1},images:{type:Array,default:()=>[]},current:{type:String},zoom:{type:[String,Number],default:2},closeable:{type:Boolean,default:!1}},m(y,["loop","indicator"])),m(X,["lockScroll","teleport"]));var N=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("var-popup",{staticClass:"var-image-preview__popup",attrs:{"var-image-preview-cover":"",transition:"var-fade",show:t.popupShow,overlay:!1,"close-on-click-overlay":!1,"lock-scroll":t.lockScroll,teleport:t.teleport},on:{open:function(o){return t.$emit("open")},close:function(o){return t.$emit("close")},closed:function(o){return t.$emit("closed")},opened:function(o){return t.$emit("opened")},"route-change":function(o){return t.$emit("route-change")}}},[n("var-swipe",t._b({staticClass:"var-image-preview__swipe",attrs:{"var-image-preview-cover":"",touchable:t.canSwipe,indicator:t.indicator&&t.images.length>1,"initial-index":t.initialIndex,loop:t.loop},on:{change:function(o){return t.$emit("change",o)}},scopedSlots:t._u([{key:"default",fn:function(){return t._l(t.images,function(o){return n("var-swipe-item",{key:o,staticClass:"var-image-preview__swipe-item",attrs:{"var-image-preview-cover":""}},[n("div",{staticClass:"var-image-preview__zoom-container",style:{transform:"scale("+t.scale+") translate("+t.translateX+"px, "+t.translateY+"px)",transitionTimingFunction:t.transitionTimingFunction,transitionDuration:t.transitionDuration},on:{touchstart:t.handleTouchstart,touchmove:t.handleTouchmove,touchend:t.handleTouchend}},[n("img",{staticClass:"var-image-preview__image",attrs:{src:o,alt:o}})])])})},proxy:!0},{key:"indicator",fn:function(o){var i=o.index,r=o.length;return[t._t("indicator",function(){return[t.indicator&&t.images.length>1?n("div",{staticClass:"var-image-preview__indicators"},[t._v(" "+t._s(i+1)+" / "+t._s(r)+" ")]):t._e()]},{index:i,length:r})]}}],null,!0)},"var-swipe",t.$attrs,!1)),t._t("close-icon",function(){return[t.closeable?n("var-icon",{staticClass:"var-image-preview__close-icon",attrs:{name:"close-circle","var-image-preview-cover":""},on:{click:t.close}}):t._e()]})],2)},R=[];const v=12,f=200,g=200,E=D({name:"VarImagePreview",components:{VarSwipe:I,VarSwipeItem:x,VarPopup:C,VarIcon:Y},inheritAttrs:!1,props:F,data:()=>({popupShow:!1,scale:1,translateX:0,translateY:0,transitionTimingFunction:void 0,transitionDuration:void 0,canSwipe:!0,startTouch:null,prevTouch:null,checker:null}),computed:{initialIndex(){const{images:t,current:e}=this,n=t.findIndex(o=>o===e);return n>=0?n:0}},watch:{show:{handler(t){this.popupShow=t},immediate:!0}},methods:{getDistance(t,e){const{clientX:n,clientY:o}=t,{clientX:i,clientY:r}=e;return Math.abs(Math.sqrt((i-n)**2+(r-o)**2))},createVarTouch(t,e){return{clientX:t.clientX,clientY:t.clientY,timestamp:Date.now(),target:e}},zoomIn(){this.scale=d(this.zoom),this.canSwipe=!1,this.prevTouch=null,window.setTimeout(()=>{this.transitionTimingFunction="linear",this.transitionDuration="0s"},g)},zoomOut(){this.scale=1,this.translateX=0,this.translateY=0,this.canSwipe=!0,this.prevTouch=null,this.transitionTimingFunction=void 0,this.transitionDuration=void 0},isDoubleTouch(t){return this.prevTouch?this.getDistance(this.prevTouch,t)<=v&&t.timestamp-this.prevTouch.timestamp<=f&&this.prevTouch.target===t.target:!1},isTapTouch(t){return!t||!this.startTouch||!this.prevTouch?!1:this.getDistance(this.startTouch,this.prevTouch)<=v&&(t===this.startTouch.target||t.parentNode===this.startTouch.target)},handleTouchend(t){this.checker=window.setTimeout(()=>{this.isTapTouch(t.target)&&this.close(),this.startTouch=null},f)},handleTouchstart(t){this.checker&&window.clearTimeout(this.checker);const{touches:e}=t,n=this.createVarTouch(e[0],t.currentTarget);if(this.startTouch=n,this.isDoubleTouch(n)){this.scale>1?this.zoomOut():this.zoomIn();return}this.prevTouch=n},getZoom(t){const{offsetWidth:e,offsetHeight:n}=t,{naturalWidth:o,naturalHeight:i}=t.querySelector(".var-image-preview__image");return{width:e,height:n,imageRadio:i/o,rootRadio:n/e,zoom:d(this.zoom)}},getLimitX(t){const{zoom:e,imageRadio:n,rootRadio:o,width:i,height:r}=this.getZoom(t);if(!n)return 0;const c=n>o?r/n:i;return Math.max(0,(e*c-i)/2)/e},getLimitY(t){const{zoom:e,imageRadio:n,rootRadio:o,width:i,height:r}=this.getZoom(t);if(!n)return 0;const c=n>o?r:i*n;return Math.max(0,(e*c-r)/2)/e},getMoveTranslate(t,e,n){return t+e>=n?n:t+e<=-n?-n:t+e},handleTouchmove(t){if(!this.prevTouch)return;const e=t.currentTarget,{touches:n}=t,o=this.createVarTouch(n[0],e);if(this.scale>1){const i=o.clientX-this.prevTouch.clientX,r=o.clientY-this.prevTouch.clientY,c=this.getLimitX(e),_=this.getLimitY(e);this.translateX=this.getMoveTranslate(this.translateX,i,c),this.translateY=this.getMoveTranslate(this.translateY,r,_)}this.prevTouch=o},close(){if(this.scale>1){this.zoomOut(),window.setTimeout(()=>this.$emit("update:show",!1),g);return}this.$emit("update:show",!1)}}}),T={};var L=M(E,N,R,!1,B,null,null,null);function B(t){for(let e in T)this[e]=T[e]}var s=function(){return L.exports}();let a;function u(t){if(!z())return;u.close();const e=V(t)?{images:[t]}:b(t)?{images:t}:t,{instance:n,unmount:o}=k(s,"body",{propsData:l({},e)});n.show=!0,a=n,n.$on("open",()=>{var i;return(i=e.onOpen)==null?void 0:i.call(e)}),n.$on("opened",()=>{var i;return(i=e.onOpened)==null?void 0:i.call(e)}),n.$on("close",()=>{var i;return(i=e.onClose)==null?void 0:i.call(e)}),n.$on("closed",()=>{var i;(i=e.onClosed)==null||i.call(e),o(),a===e&&(a=null)}),n.$on("change",i=>{var r;(r=e.onChange)==null||r.call(e,i)}),n.$on("route-change",()=>{o(),a===n&&(a=null)}),n.$on("update:show",i=>{n.show=i}),n.show=!0}u.close=()=>{if(a!=null){const t=a;a=null,A.nextTick(()=>{t.show=!1})}};s.install=function(t){t.component(s.name,s)};u.install=function(t){t.component(s.name,s)};u.Component=s;export{u as I};
